{
  "name": "W7 - Patient Intake Processor for Healthcare",
  "nodes": [
    {
      "parameters": {
        "content": "## üè• Patient Intake Processor\n\n**HIPAA Compliance Note:**\nThis workflow processes PHI. Ensure:\n- n8n is self-hosted securely\n- All connections use encryption\n- Access is restricted\n- Audit logs are enabled\n\n**What it does:**\n1. Monitors folder for intake forms\n2. Extracts patient information\n3. Validates insurance details\n4. Creates patient record\n5. Alerts medical staff\n6. Critical allergy warnings\n\n**Setup Required:**\n1. Google Drive credential\n2. PDF Vector credential\n3. Google Sheets credential\n4. Slack credential\n5. Create intake forms folder\n6. Create patient database sheet",
        "height": 420,
        "width": 340
      },
      "id": "sticky-main",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        60,
        100
      ]
    },
    {
      "parameters": {
        "content": "## ‚ö†Ô∏è Data Fields Extracted\n\n- Demographics (name, DOB, gender)\n- Contact info (phone, email, address)\n- Insurance info (provider, policy, group)\n- Medical history (conditions, surgeries)\n- Current medications (name, dosage, frequency)\n- Allergies (allergen, reaction severity)\n- Emergency contacts\n- Reason for visit",
        "height": 260,
        "width": 280
      },
      "id": "sticky-data",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        420,
        100
      ]
    },
    {
      "parameters": {
        "content": "## üìä Google Sheets Columns\n\nCreate these columns in Row 1:\n\nPatient ID | Name | DOB | Age | Gender | Phone | Email | Insurance | Conditions | Medications | Allergies | Reason for Visit | Emergency Contact | Intake Date",
        "height": 160,
        "width": 340
      },
      "id": "sticky-sheets",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        60,
        540
      ]
    },
    {
      "parameters": {
        "content": "## üö® Critical Allergy Detection\n\nAuto-alerts for these allergens:\n- Penicillin\n- Sulfa\n- Latex\n- Iodine\n\nEdit the Code node to add more critical allergens.",
        "height": 180,
        "width": 240
      },
      "id": "sticky-allergy",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        720,
        100
      ]
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "YOUR_FOLDER_ID",
          "mode": "list"
        },
        "event": "fileCreated",
        "options": {}
      },
      "id": "gdrive-trigger",
      "name": "Google Drive Trigger",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        140,
        360
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "YOUR_DRIVE_CREDENTIAL_ID",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "id": "gdrive-download",
      "name": "Download File",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        340,
        360
      ],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "YOUR_DRIVE_CREDENTIAL_ID",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "document",
        "operation": "extract",
        "inputType": "file",
        "binaryPropertyName": "data",
        "prompt": "Extract all patient intake information from this healthcare form:\n\n1. Patient Information:\n   - First name, last name\n   - Date of birth\n   - Gender\n   - SSN (last 4 digits only if present)\n   - Phone number, email\n   - Full address\n\n2. Insurance Information:\n   - Insurance provider name\n   - Policy number\n   - Group number\n   - Subscriber name\n   - Relationship to subscriber\n\n3. Medical History:\n   - Current/past medical conditions\n   - Past surgeries with dates\n   - Family medical history\n\n4. Current Medications:\n   - Medication name\n   - Dosage\n   - Frequency\n\n5. Allergies:\n   - Allergen name\n   - Reaction/severity description\n\n6. Emergency Contact:\n   - Name\n   - Relationship\n   - Phone number\n\n7. Reason for today's visit",
        "schema": "{\"type\":\"object\",\"properties\":{\"patientInfo\":{\"type\":\"object\",\"properties\":{\"firstName\":{\"type\":\"string\"},\"lastName\":{\"type\":\"string\"},\"dateOfBirth\":{\"type\":\"string\"},\"gender\":{\"type\":\"string\"},\"ssn\":{\"type\":\"string\"},\"phone\":{\"type\":\"string\"},\"email\":{\"type\":\"string\"},\"address\":{\"type\":\"string\"}}},\"insurance\":{\"type\":\"object\",\"properties\":{\"provider\":{\"type\":\"string\"},\"policyNumber\":{\"type\":\"string\"},\"groupNumber\":{\"type\":\"string\"},\"subscriberName\":{\"type\":\"string\"},\"subscriberRelation\":{\"type\":\"string\"}}},\"medicalHistory\":{\"type\":\"object\",\"properties\":{\"conditions\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"surgeries\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}},\"familyHistory\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}}}},\"currentMedications\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"dosage\":{\"type\":\"string\"},\"frequency\":{\"type\":\"string\"}}}},\"allergies\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"allergen\":{\"type\":\"string\"},\"reaction\":{\"type\":\"string\"}}}},\"emergencyContact\":{\"type\":\"object\",\"properties\":{\"name\":{\"type\":\"string\"},\"relation\":{\"type\":\"string\"},\"phone\":{\"type\":\"string\"}}},\"reasonForVisit\":{\"type\":\"string\"}},\"required\":[\"patientInfo\"],\"additionalProperties\":false}"
      },
      "id": "pdfvector-extract",
      "name": "PDF Vector - Extract Intake",
      "type": "n8n-nodes-pdfvector.pdfVector",
      "typeVersion": 1,
      "position": [
        540,
        360
      ],
      "credentials": {
        "pdfVectorApi": {
          "id": "YOUR_PDFVECTOR_CREDENTIAL_ID",
          "name": "PDF Vector account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json.data;\nconst patient = data.patientInfo || {};\nconst insurance = data.insurance || {};\n\n// Generate patient ID\nconst patientId = `PT-${Date.now().toString(36).toUpperCase()}`;\n\n// Calculate age from DOB\nlet age = 'N/A';\nif (patient.dateOfBirth) {\n  const dob = new Date(patient.dateOfBirth);\n  const today = new Date();\n  age = Math.floor((today - dob) / (365.25 * 24 * 60 * 60 * 1000));\n}\n\n// Format medications list\nconst medications = data.currentMedications && data.currentMedications.length > 0\n  ? data.currentMedications.map(m => `${m.name} ${m.dosage} (${m.frequency})`).join('; ')\n  : 'None reported';\n\n// Format allergies with reaction severity\nconst allergies = data.allergies && data.allergies.length > 0\n  ? data.allergies.map(a => `${a.allergen} (${a.reaction})`).join('; ')\n  : 'NKDA'; // No Known Drug Allergies\n\n// Format medical conditions\nconst conditions = data.medicalHistory && data.medicalHistory.conditions\n  ? data.medicalHistory.conditions.join('; ')\n  : 'None reported';\n\n// ============================================\n// CRITICAL ALLERGY DETECTION\n// Add more allergens to this list as needed\n// ============================================\nconst criticalAllergens = ['penicillin', 'sulfa', 'latex', 'iodine', 'aspirin', 'nsaid'];\nconst hasCriticalAllergy = data.allergies && data.allergies.some(a => \n  criticalAllergens.some(c => a.allergen.toLowerCase().includes(c))\n);\n\nreturn [{\n  json: {\n    patientId: patientId,\n    fullName: `${patient.firstName || ''} ${patient.lastName || ''}`.trim() || 'Unknown',\n    ...patient,\n    age: age,\n    insurance: insurance,\n    insuranceSummary: insurance.provider \n      ? `${insurance.provider} - ${insurance.policyNumber}` \n      : 'Self-Pay',\n    medications: medications,\n    allergies: allergies,\n    conditions: conditions,\n    reasonForVisit: data.reasonForVisit || 'Not specified',\n    emergencyContact: data.emergencyContact,\n    hasCriticalAllergy: hasCriticalAllergy,\n    processedAt: new Date().toISOString()\n  }\n}];"
      },
      "id": "process-intake",
      "name": "Process Intake Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        740,
        360
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "YOUR_SPREADSHEET_ID",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Patient ID": "={{ $json.patientId }}",
            "Name": "={{ $json.fullName }}",
            "DOB": "={{ $json.dateOfBirth }}",
            "Age": "={{ $json.age }}",
            "Gender": "={{ $json.gender || 'N/A' }}",
            "Phone": "={{ $json.phone || 'N/A' }}",
            "Email": "={{ $json.email || 'N/A' }}",
            "Insurance": "={{ $json.insuranceSummary }}",
            "Conditions": "={{ $json.conditions }}",
            "Medications": "={{ $json.medications }}",
            "Allergies": "={{ $json.allergies }}",
            "Reason for Visit": "={{ $json.reasonForVisit }}",
            "Emergency Contact": "={{ $json.emergencyContact ? $json.emergencyContact.name + ' (' + $json.emergencyContact.phone + ')' : 'N/A' }}",
            "Intake Date": "={{ $json.processedAt.split('T')[0] }}"
          }
        },
        "options": {}
      },
      "id": "sheets-log",
      "name": "Create Patient Record",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        940,
        360
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YOUR_SHEETS_CREDENTIAL_ID",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "critical-allergy-check",
              "leftValue": "={{ $('Process Intake Data').item.json.hasCriticalAllergy }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-critical",
      "name": "Critical Allergy?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1140,
        360
      ]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "YOUR_ALERTS_CHANNEL_ID",
          "mode": "list"
        },
        "text": "=üö® *CRITICAL ALLERGY ALERT*\n\n*Patient:* {{ $('Process Intake Data').item.json.fullName }}\n*Patient ID:* {{ $('Process Intake Data').item.json.patientId }}\n*DOB:* {{ $('Process Intake Data').item.json.dateOfBirth }}\n\n‚ö†Ô∏è *ALLERGIES:* {{ $('Process Intake Data').item.json.allergies }}\n\n*Reason for Visit:* {{ $('Process Intake Data').item.json.reasonForVisit }}",
        "otherOptions": {}
      },
      "id": "slack-alert",
      "name": "Critical Alert",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        1340,
        260
      ],
      "credentials": {
        "slackOAuth2Api": {
          "id": "YOUR_SLACK_CREDENTIAL_ID",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "YOUR_INTAKE_CHANNEL_ID",
          "mode": "list"
        },
        "text": "=‚úÖ *New Patient Intake*\n\n*Patient:* {{ $('Process Intake Data').item.json.fullName }}\n*Patient ID:* {{ $('Process Intake Data').item.json.patientId }}\n*Age:* {{ $('Process Intake Data').item.json.age }}\n*Insurance:* {{ $('Process Intake Data').item.json.insuranceSummary }}\n*Reason:* {{ $('Process Intake Data').item.json.reasonForVisit }}",
        "otherOptions": {}
      },
      "id": "slack-notify",
      "name": "Notify Front Desk",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [
        1340,
        460
      ],
      "credentials": {
        "slackOAuth2Api": {
          "id": "YOUR_SLACK_CREDENTIAL_ID",
          "name": "Slack account"
        }
      }
    }
  ],
  "connections": {
    "Google Drive Trigger": {
      "main": [
        [
          {
            "node": "Download File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download File": {
      "main": [
        [
          {
            "node": "PDF Vector - Extract Intake",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PDF Vector - Extract Intake": {
      "main": [
        [
          {
            "node": "Process Intake Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Intake Data": {
      "main": [
        [
          {
            "node": "Create Patient Record",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Patient Record": {
      "main": [
        [
          {
            "node": "Critical Allergy?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Critical Allergy?": {
      "main": [
        [
          {
            "node": "Critical Alert",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Notify Front Desk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "PDF Vector"
    },
    {
      "name": "Healthcare"
    },
    {
      "name": "HIPAA"
    },
    {
      "name": "Patient Intake"
    },
    {
      "name": "Medical"
    }
  ],
  "triggerCount": 0,
  "meta": {
    "templateCredsSetupCompleted": false
  }
}
